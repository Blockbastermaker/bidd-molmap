# MolMap: A Molecule Representation Method Based on High-level Features

## MolMap
MolMap is generated by the following steps:

* Step1: Sample data 
* Step2: Feature extraction
* Step3: Calculate feature pairwise distance
* Step4: Feature 2D embedding
* Step5: Linear assignment to grid
* Step5: Gaussian smoothing
* Step6: Get MolMap


## installation

1. install [rdkit]('http://www.rdkit.org/docs/Install.html) first:
```bash
conda create -c rdkit -n my-rdkit-env rdkit
conda activate my-rdkit-env
```
2. in your "my-rdkit-env" env, install molmap by:

```bash
git clone https://github.com/shenwanxiang/bidd-molmap.git
cd bidd-molmap
pip install -r requirements.txt --user

# add molmap to PYTHONPATH
echo export PYTHONPATH="\$PYTHONPATH:`pwd`" >> ~/.bashrc

# init bashrc
source ~/.bashrc
```

## Usage

```python
import molmap
mp = molmap.MolMap(ftype = 'descriptor', fmap_type = 'grid')
mp.fit(method = 'umap', min_dist = 0.1, n_neighbors = 50)
```

```python
#visulization your molmap
mp.plot_scatter(htmlpath='./html', htmlname= 'test')
mp.plot_grid(htmlpath='./html', htmlname= 'grid')
```
<img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/html/scatter.png?raw=true" style="float: left; margin-right: 10px;" width="850" height="700" />
<img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/html/grid.png?raw=true" style="float: left; margin-right: 10px;" width="850" height="700" />



```python
#transform smiles
smiles_list = ['CC(=O)OC1=CC=CC=C1C(O)=O', 
               'CC(=O)NC1=CC=CC=C1C(O)=O',
               'CC(=O)CC1=CC=CC=C1C(O)=O']
x = mp.batch_transform(smiles_list, scale = True, 
                       scale_method = 'standard', 
                       smoothing = True, kernel_size = 41, 
                       sigma=2)
print(x.shape)
#3,37,37
```

```python
from rdkit import Chem
from rdkit.Chem import Draw
import matplotlib.pyplot as plt

#save your molmap image:
for i in range(len(smiles_list)):
    plt.imsave('./results/%s.png' % i, x[i], cmap = 'hsv')
    
for i, smiles in enumerate(smiles_list):
    fig = Draw.MolToMPL(Chem.MolFromSmiles(smiles), fitImage = True)
    fig.savefig('./results/mol_%s.png' % i, bbox_inches='tight')
    
```
Three compunds' molmap representation by images:
-----
<p float="center">
  <img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/results/mol_0.png?raw=true" width="150" height="150"/> 
  <img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/results/0.png?raw=true" width="150" height="150" />
</p>
<p float="center">
  <img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/results/mol_1.png?raw=true" width="150" height="150"/> 
  <img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/results/1.png?raw=true" width="150" height="150" />
</p>
<p float="center">
  <img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/results/mol_2.png?raw=true" width="150" height="150"/> 
  <img src="https://github.com/shenwanxiang/bidd-molmap/blob/master/paper/results/2.png?raw=true" width="150" height="150" />
</p>

